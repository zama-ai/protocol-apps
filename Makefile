# Full list of SPDX identifiers can be found here: https://spdx.org/licenses/
# The following packages are exceptionally excluded from the check:
# - estraverse@1.9.3: invalid SPDX identifier (`BSD`) but licensed under `BSD-2-Clause` (https://www.npmjs.com/package/estraverse)
# - jackspeak@3.4.: licensed under `BlueOak-1.0.0` (https://www.npmjs.com/package/jackspeak)
# - package-json-from-dist@1.0.1: licensed under `BlueOak-1.0.0` (https://www.npmjs.com/package/package-json-from-dist)
# - path-scurry@1.11.1: licensed under `BlueOak-1.0.0` (https://www.npmjs.com/package/path-scurry)
# - path-scurry@2.0.1: licensed under `BlueOak-1.0.0` (https://www.npmjs.com/package/path-scurry)
# - source-map@0.2.0: invalid SPDX identifier (`BSD`) but licensed under `BSD-3-Clause` (https://www.npmjs.com/package/source-map)
# - web3-utils@1.10.4: licensed under `LGPL-3.0 license` (https://www.npmjs.com/package/web3-utils), which we only allow for tooling
# - glob@13.0.0: licensed under `BlueOak-1.0.0` (https://www.npmjs.com/package/glob)
# - lru-cache@11.2.4: licensed under `BlueOak-1.0.0` (https://www.npmjs.com/package/lru-cache)
# - minimatch@10.1.1: licensed under `BlueOak-1.0.0` (https://www.npmjs.com/package/minimatch)
# - rimraf@6.1.2: licensed under `BlueOak-1.0.0` (https://www.npmjs.com/package/rimraf)
# - @chainlink/contracts-ccip@0.7.6: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@chainlink/contracts-ccip), which we only allow for tooling
# - @layerzerolabs/lz-definitions@3.0.143: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-definitions), which we only allow for tooling
# - @layerzerolabs/lz-evm-messagelib-v2@3.0.142: licensed under `UNKNOWN` but actually licenses under `LZBL-1.2` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-messagelib-v2), which we only allow for tooling
# - @layerzerolabs/lz-evm-protocol-v2@3.0.142: licensed under `UNKNOWN` but actually licenses under `LZBL-1.2` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-protocol-v2), which we only allow for tooling
# - @layerzerolabs/lz-evm-v1-0.7@3.0.142: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-v1-0.7), which we only allow for tooling
# - @layerzerolabs/lz-v2-utilities@3.0.143: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-v2-utilities), which we only allow for tooling
# - @layerzerolabs/metadata-tools@3.0.0: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/metadata-tools), which we only allow for tooling
# - @nomicfoundation/ignition-ui@0.15.12: licensed under custom license but actually licensed under `MIT` (https://www.npmjs.com/package/@nomicfoundation/ignition-ui)
# - @layerzerolabs/lz-definitions@3.0.156: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-v2-utilities), which we only allow for tooling
# - @layerzerolabs/lz-evm-messagelib-v2@3.0.156: licensed under `UNKNOWN` but actually licenses under `LZBL-1.2` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-messagelib-v2), which we only allow for tooling
# - @layerzerolabs/lz-evm-protocol-v2@3.0.156: licensed under `UNKNOWN` but actually licenses under `LZBL-1.2` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-protocol-v2), which we only allow for tooling
# - @layerzerolabs/lz-evm-sdk-v2@3.0.156: licensed under `UNKNOWN` but actually licenses under `LZBL-1.2` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-sdk-v2), which we only allow for tooling
# - @layerzerolabs/lz-evm-v1-0.7@3.0.156: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-v1-0.7), which we only allow for tooling
# - @layerzerolabs/lz-v2-utilities@3.0.156: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-v2-utilities), which we only allow for tooling
# - @layerzerolabs/solhint-config@3.0.156: licensed under `UNLICENSED` (https://www.npmjs.com/package/@layerzerolabs/solhint-config), which we only allow for tooling
# - @safe-global/safe-contracts@1.4.1-2: licensed under `LGPL-3.0` (https://www.npmjs.com/package/@safe-global/safe-contracts), which we only allow for tooling
# - solhint-plugin-openzeppelin@0.0.0: licensed under `UNLICENSED` (https://www.npmjs.com/package/solhint-plugin-openzeppelin), which we only allow for tooling
# - web3-errors@1.3.1: licensed under `LGPL-3.0` (https://www.npmjs.com/package/web3-errors), which we only allow for tooling
# - web3-types@1.10.0: licensed under `LGPL-3.0` (https://www.npmjs.com/package/web3-types), which we only allow for tooling
# - web3-validator@2.0.6: licensed under `LGPL-3.0` (https://www.npmjs.com/package/web3-validator), which we only allow for tooling
# - @layerzerolabs/lz-definitions@3.0.155: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-definitions), which we only allow for tooling
# - @layerzerolabs/lz-evm-messagelib-v2@3.0.155: licensed under `UNKNOWN` but actually licenses under `LZBL-1.2` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-messagelib-v2), which we only allow for tooling
# - @layerzerolabs/lz-evm-protocol-v2@3.0.155: licensed under `UNKNOWN` but actually licenses under `LZBL-1.2` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-protocol-v2), which we only allow for tooling
# - @layerzerolabs/lz-evm-sdk-v2@3.0.155: licensed under `UNKNOWN` but actually licenses under `LZBL-1.2` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-sdk-v2), which we only allow for tooling
# - @layerzerolabs/lz-evm-v1-0.7@3.0.155: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-evm-v1-0.7), which we only allow for tooling
# - @layerzerolabs/lz-v2-utilities@3.0.155: licensed under `BUSL-1.1` (https://www.npmjs.com/package/@layerzerolabs/lz-v2-utilities), which we only allow for tooling
# - @layerzerolabs/solhint-config@3.0.155: licensed under `UNLICENSED` (https://www.npmjs.com/package/@layerzerolabs/solhint-config), which we only allow for tooling
EXCLUDE_PACKAGES := estraverse@1.9.3;jackspeak@3.4.3;package-json-from-dist@1.0.1;path-scurry@1.11.1;path-scurry@2.0.1;source-map@0.2.0;web3-utils@1.10.4;glob@13.0.0;lru-cache@11.2.4;minimatch@10.1.1;rimraf@6.1.2;@chainlink/contracts-ccip@0.7.6;@layerzerolabs/lz-definitions@3.0.143;@layerzerolabs/lz-evm-messagelib-v2@3.0.142;@layerzerolabs/lz-evm-protocol-v2@3.0.142;@layerzerolabs/lz-evm-v1-0.7@3.0.142;@layerzerolabs/lz-v2-utilities@3.0.143;@layerzerolabs/metadata-tools@3.0.0;@nomicfoundation/ignition-ui@0.15.12;@layerzerolabs/lz-definitions@3.0.156;@layerzerolabs/lz-evm-messagelib-v2@3.0.156;@layerzerolabs/lz-evm-protocol-v2@3.0.156;@layerzerolabs/lz-evm-sdk-v2@3.0.156;@layerzerolabs/lz-evm-v1-0.7@3.0.156;@layerzerolabs/lz-v2-utilities@3.0.156;@layerzerolabs/solhint-config@3.0.156;@safe-global/safe-contracts@1.4.1-2;solhint-plugin-openzeppelin@0.0.0;web3-errors@1.3.1;web3-types@1.10.0;web3-validator@2.0.6;@layerzerolabs/lz-definitions@3.0.155;@layerzerolabs/lz-evm-messagelib-v2@3.0.155;@layerzerolabs/lz-evm-protocol-v2@3.0.155;@layerzerolabs/lz-evm-sdk-v2@3.0.155;@layerzerolabs/lz-evm-v1-0.7@3.0.155;@layerzerolabs/lz-v2-utilities@3.0.155;@layerzerolabs/solhint-config@3.0.155;
ALLOWED_LICENSES := 0BSD;Apache-2.0;BSD-2-Clause;BSD-3-Clause;BSD-3-Clause-Clear;CC-BY-3.0;CC0-1.0;ISC;MIT;MPL-2.0;Python-2.0;WTFPL;PSF

# NOTE:
# - fhevm-deployment-cli@0.1.0: licensed under `BSD-3-Clause-Clear` but we use bun which makes the license checker fail
# - @zama/governance-oapp@0.1.0: licensed under `MIT` but we use pnpm which makes the license checker fail
# - @zama/token@0.1.0: licensed under `BSD-3-Clause-Clear` but we use pnpm which makes the license checker fail
check-licenses:
	@for dir in contracts/*/; do \
		# Exclude some directories \
		if [ "$$(basename $$dir)" = "deployment-cli" ] || [ "$$(basename $$dir)" = "governance" ] || [ "$$(basename $$dir)" = "token" ]; then \
			continue; \
		fi; \
		if [ -f "$$dir/package.json" ]; then \
			echo "Checking licenses in $$dir..."; \
			output=$$(cd "$$dir" && npx license-checker --onlyAllow '$(ALLOWED_LICENSES)' --excludePackages '$(EXCLUDE_PACKAGES)' 2>&1); \
			status=$$?; \
			if [ $$status -ne 0 ]; then \
				printf '%s\n' "$$output"; \
				exit $$status; \
			fi; \
		fi; \
	done
	@echo "All license checks passed!"

